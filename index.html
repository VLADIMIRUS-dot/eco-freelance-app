<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EcoFreelance App</title>
    <link rel="preconnect" href="https://telegram.org">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/desktop.css">
</head>
<body>
    <div id="app-wrapper">
        <main id="main-content">

            <!-- –≠–ö–†–ê–ù 1: –ü–†–û–§–ò–õ–¨ -->
            <section id="view-profile" class="view active"></section>

            <!-- –≠–ö–†–ê–ù 2: –ü–†–û–ï–ö–¢–´ -->
            <section id="view-projects" class="view">
                <div class="section-header">
                    <h2>–ü—Ä–æ–µ–∫—Ç—ã</h2>
                    <div class="filters admin-only hidden">
                        <span class="filter-chip active">–í—Å–µ</span>
                        <span class="filter-chip">–î–æ–ª–∂–Ω–∏–∫–∏</span>
                        <span class="filter-chip">–í —Ä–∞–±–æ—Ç–µ</span>
                    </div>
                </div>
                <div id="projects-list" class="projects-container"></div>
            </section>

            <!-- –≠–ö–†–ê–ù 3: –£–°–õ–£–ì–ò -->
            <section id="view-services" class="view">
                <div class="calc-mode-switch">
                    <button class="mode-btn active" data-action="switch-calc-mode" data-mode="simple">–ë—ã—Å—Ç—Ä—ã–π</button>
                    <button class="mode-btn" data-action="switch-calc-mode" data-mode="advanced">–°–º–µ—Ç–∞ (–ö–ü)</button>
                </div>

                <!-- Simple Mode -->
                <div id="calc-simple-mode">
                    <div class="calculator-card">
                        <div class="form-group">
                            <label>–ß—Ç–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º?</label>
                            <select id="calc-service-type"></select>
                        </div>
                        <div id="dynamic-calc-inputs"></div>
                        <div class="form-group">
                            <label>–î–æ–∫—É–º–µ–Ω—Ç—ã (–¢–ó, –°–ø—Ä–∞–≤–∫–∏)</label>
                            <div class="file-upload-area" onclick="document.getElementById('calc-file-input').click()">
                                <input type="file" id="calc-file-input" multiple hidden>
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <span>–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã</span>
                                <small>PDF, DOCX, ZIP –¥–æ 20 –ú–±</small>
                            </div>
                            <div id="file-list-display" class="file-list"></div>
                        </div>
                        <div class="calc-result">
                            <div class="price-box"><span>–û—Ä–∏–µ–Ω—Ç–∏—Ä:</span><h3 id="calc-total-price">0 ‚ÇΩ</h3></div>
                            <div class="time-box"><span>–°—Ä–æ–∫:</span><strong id="calc-total-time">0 –¥–Ω–µ–π</strong></div>
                        </div>
                        <button class="btn btn-primary full-width" data-action="order-calc">–û–±—Å—É–¥–∏—Ç—å —Ä–∞—Å—á–µ—Ç</button>
                    </div>
                    <div class="services-list">
                        <h3>–°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥</h3>
                        <div id="services-container"></div>
                    </div>
                </div>

                <!-- Advanced Mode -->
                <div id="calc-advanced-mode" class="hidden">
                    <div id="estimate-container"></div>
                    <button class="btn btn-outline full-width dashed-btn" data-action="add-est-obj">
                        <i class="fa-solid fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç
                    </button>
                    <div class="estimate-footer">
                        <div class="total-row"><span>–ò—Ç–æ–≥–æ –ø–æ —Å–º–µ—Ç–µ:</span><strong id="estimate-total-sum">0 ‚ÇΩ</strong></div>
                        <button class="btn btn-primary full-width" data-action="send-estimate">üìÑ –ü–æ–ª—É—á–∏—Ç—å –ö–ü –≤ Telegram</button>
                    </div>
                </div>
            </section>

            <!-- –≠–ö–†–ê–ù 4: –ü–ê–†–¢–ù–ï–†–´ (–ê–î–ú–ò–ù) -->
            <section id="view-partners" class="view admin-only hidden">
                <div class="section-header"><h2>–ü–∞—Ä—Ç–Ω–µ—Ä—ã (CRM)</h2></div>
                <div id="partners-list" class="partners-list"></div>
            </section>

            <!-- –≠–ö–†–ê–ù 5: –ü–†–û–§–ò–õ–¨ –ö–õ–ò–ï–ù–¢–ê -->
            <section id="view-partner" class="view">
                <div id="partner-auth" class="modal-content partner-form-content hidden" style="box-shadow: none; padding-top: 40px;">
                    <div class="partner-header">
                        <i class="fa-solid fa-handshake"></i>
                        <h2>–î–∞–≤–∞–π—Ç–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è!</h2>
                        <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –î–æ–≥–æ–≤–æ—Ä–æ–≤.</p>
                    </div>
                    <form id="partner-form" onsubmit="event.preventDefault();">
                        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ / –ò–ü</label><input type="text" id="p-name" placeholder="–û–û–û '–†–æ–º–∞—à–∫–∞'" required></div>
                        <div class="form-group"><label>–ò–ù–ù</label><input type="tel" id="p-inn" placeholder="–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù"></div>
                        <div class="form-group"><label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label><input type="text" id="p-contact" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á"></div>
                        <div class="form-group"><label>Email</label><input type="email" id="p-email" placeholder="buh@example.com"></div>
                        <button type="submit" class="btn btn-primary full-width" data-action="partner-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –í–æ–π—Ç–∏</button>
                    </form>
                </div>

                <div id="partner-dashboard" class="hidden">
                    <div class="lk-header">
                        <div class="lk-avatar"><i class="fa-solid fa-building"></i></div>
                        <div class="lk-info"><h2 id="lk-company-name">...</h2><p id="lk-inn">–ò–ù–ù: ‚Äî</p></div>
                        <button class="btn-icon-only" data-action="partner-edit"><i class="fa-solid fa-pen"></i></button>
                    </div>
                    <div class="loyalty-card">
                        <div class="loyalty-row"><span>–í–∞—à —Å—Ç–∞—Ç—É—Å:</span><strong id="lk-status">–ù–æ–≤—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä</strong></div>
                        <div class="loyalty-desc">–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç".</div>
                    </div>
                    <div class="menu-list" style="margin-top: 0;">
                        <div class="menu-item" data-action="contact-telegram">
                            <div class="menu-icon-box" style="background: rgba(36, 129, 204, 0.1); color: #2481cc;"><i class="fa-solid fa-headset"></i></div>
                            <div class="menu-text"><span>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</span><small>–ù–∞–ø–∏—Å–∞—Ç—å –í–ª–∞–¥–∏–º–∏—Ä—É</small></div>
                            <i class="fa-solid fa-chevron-right arrow-icon"></i>
                        </div>
                    </div>
                    <div class="lk-details">
                        <h3>–†–µ–∫–≤–∏–∑–∏—Ç—ã</h3>
                        <div class="detail-row"><span>–ö–æ–Ω—Ç–∞–∫—Ç:</span><span id="lk-contact">‚Äî</span></div>
                        <div class="detail-row"><span>Email:</span><span id="lk-email">‚Äî</span></div>
                    </div>
                    <button class="btn btn-outline full-width" data-action="partner-logout" style="border-color: var(--status-red); color: var(--status-red); margin-top: 20px;">
                        <i class="fa-solid fa-arrow-right-from-bracket"></i> –í—ã–π—Ç–∏
                    </button>
                </div>
            </section>

        </main>

        <!-- MODALS -->
        <div id="project-detail-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal" data-action="close-modal">&times;</span>
                <div id="modal-body"></div>
            </div>
        </div>

        <div id="status-edit-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal" data-action="close-modal">&times;</span>
                <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                <div class="form-group">
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç: <span id="edit-percent-val">0</span>%</label>
                    <input type="range" id="edit-percent" min="0" max="100" step="5" class="calc-input">
                </div>
                <div class="form-group">
                    <label>–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞</label>
                    <input type="text" id="edit-status-text">
                </div>
                <div class="color-picker-row"></div> <!-- –°–∫—Ä—ã—Ç CSS-–æ–º -->
                <button class="btn btn-primary full-width" data-action="save-status">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>

        <!-- NAVIGATION -->
        <nav class="bottom-nav">
            <div class="nav-item active" data-target="view-profile"><i class="fa-solid fa-user"></i><span>–≠–∫–æ–ª–æ–≥</span></div>
            <div class="nav-item" data-target="view-projects"><i class="fa-solid fa-briefcase"></i><span>–ü—Ä–æ–µ–∫—Ç—ã</span></div>
            <div class="nav-item" data-target="view-services"><i class="fa-solid fa-calculator"></i><span>–†–∞—Å—á–µ—Ç</span></div>
            <div class="nav-item" data-target="view-partner"><i class="fa-solid fa-building"></i><span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
            <div class="nav-item admin-only hidden" data-target="view-partners"><i class="fa-solid fa-gem"></i><span>CRM</span></div>
        </nav>
    </div>

    <script src="js/data.js" defer></script>
    <script src="js/views.js" defer></script>
    <script src="js/logic.js" defer></script>
</body>
</html>