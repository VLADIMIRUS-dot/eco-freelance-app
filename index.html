<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EcoFreelance App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/desktop.css">
</head>
<body>
    <div id="app-wrapper">
        <main id="main-content">

            <!-- –≠–ö–†–ê–ù 0: –ü–†–ò–í–ï–¢–°–¢–í–ò–ï (–ù–û–í–û–ï) -->
            <section id="view-welcome" class="view">
                <div class="welcome-container" style="padding: 40px 20px; text-align: center;">
                    <div style="font-size: 4rem; color: var(--tg-theme-button-color); margin-bottom: 20px;">
                        <i class="fa-solid fa-leaf"></i>
                    </div>
                    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
                    <p style="color: var(--tg-theme-hint-color); margin-bottom: 30px;">
                        –Ø ‚Äî –í–ª–∞–¥–∏–º–∏—Ä, –∏–Ω–∂–µ–Ω–µ—Ä-—ç–∫–æ–ª–æ–≥.<br>–ó–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã –ù–î–í, –°–ó–ó –∏ –ü–≠–ö –±–µ–∑ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤.
                    </p>
                    
                    <form id="welcome-form" onsubmit="event.preventDefault();" style="text-align: left;">
                        <div class="form-group">
                            <label>–í–∞—à–µ –∏–º—è</label>
                            <input type="text" id="w-contact" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
                        </div>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                            <input type="text" id="w-name" placeholder="–û–û–û '–†–æ–º–∞—à–∫–∞'" required>
                        </div>
						<div class="form-group">
							<label>–ò–ù–ù (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
							<input type="tel" id="w-inn" placeholder="–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù" required>
						</div>
                        <button type="submit" class="btn btn-primary full-width btn-attention" data-action="complete-registration">
                            –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
                        </button>
                    </form>
                </div>
            </section>

            <!-- –≠–ö–†–ê–ù 1: –ü–†–û–§–ò–õ–¨ -->
            <section id="view-profile" class="view"></section>

            <!-- –≠–ö–†–ê–ù 2: –ü–†–û–ï–ö–¢–´ -->
            <section id="view-projects" class="view">
                <div class="section-header">
                    <h2>–ü—Ä–æ–µ–∫—Ç—ã</h2>
                    <div class="filters admin-only hidden">
                        <span class="filter-chip active">–í—Å–µ</span>
                        <span class="filter-chip">–î–æ–ª–∂–Ω–∏–∫–∏</span>
                        <span class="filter-chip">–í —Ä–∞–±–æ—Ç–µ</span>
                    </div>
                </div>
                <div id="projects-list" class="projects-container"></div>
            </section>

            <!-- –≠–ö–†–ê–ù 3: –£–°–õ–£–ì–ò -->
            <section id="view-services" class="view">
                <div class="calc-mode-switch">
                    <button class="mode-btn active" data-action="switch-calc-mode" data-mode="simple">–ë—ã—Å—Ç—Ä—ã–π</button>
                    <button class="mode-btn" data-action="switch-calc-mode" data-mode="advanced">–°–º–µ—Ç–∞ (–ö–ü)</button>
                </div>

                <!-- Simple Mode -->
                <div id="calc-simple-mode">
                    <div class="calculator-card">
                        <div class="form-group">
                            <label>–ß—Ç–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º?</label>
                            <select id="calc-service-type"></select>
                        </div>
                        <div id="dynamic-calc-inputs"></div>
                        <div class="form-group">
                            <label>–î–æ–∫—É–º–µ–Ω—Ç—ã (–¢–ó, –°–ø—Ä–∞–≤–∫–∏)</label>
                            <div class="file-upload-area" onclick="document.getElementById('calc-file-input').click()">
                                <input type="file" id="calc-file-input" multiple hidden>
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <span>–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã</span>
                            </div>
                            <div id="file-list-display" class="file-list"></div>
                        </div>
                        <div class="calc-result">
                            <div class="price-box"><span>–û—Ä–∏–µ–Ω—Ç–∏—Ä:</span><h3 id="calc-total-price">0 ‚ÇΩ</h3></div>
                            <div class="time-box"><span>–°—Ä–æ–∫:</span><strong id="calc-total-time">0 –¥–Ω–µ–π</strong></div>
                        </div>
                        <button class="btn btn-primary full-width" data-action="order-calc">–û–±—Å—É–¥–∏—Ç—å —Ä–∞—Å—á–µ—Ç</button>
                    </div>
                    <div class="services-list">
                        <h3>–°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥</h3>
                        <div id="services-container"></div>
                    </div>
                </div>

                <!-- Advanced Mode -->
                <div id="calc-advanced-mode" class="hidden">
                    <div id="estimate-container"></div>
                    <button class="btn btn-outline full-width dashed-btn" data-action="add-est-obj">
                        <i class="fa-solid fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç
                    </button>
                    <div class="estimate-footer">
                        <div class="total-row"><span>–ò—Ç–æ–≥–æ –ø–æ —Å–º–µ—Ç–µ:</span><strong id="estimate-total-sum">0 ‚ÇΩ</strong></div>
                        <button class="btn btn-primary full-width" data-action="send-estimate">üìÑ –ü–æ–ª—É—á–∏—Ç—å –ö–ü –≤ Telegram</button>
                    </div>
                </div>
            </section>

            <!-- –≠–ö–†–ê–ù 4: –ü–ê–†–¢–ù–ï–†–´ (–ê–î–ú–ò–ù) -->
            <section id="view-partners" class="view admin-only hidden">
                <div class="section-header"><h2>–ü–∞—Ä—Ç–Ω–µ—Ä—ã (CRM)</h2></div>
                <div id="partners-list" class="partners-list"></div>
            </section>

            <!-- –≠–ö–†–ê–ù 5: –ü–†–û–§–ò–õ–¨ –ö–õ–ò–ï–ù–¢–ê -->
            <section id="view-partner" class="view">
                <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                <div id="partner-edit-mode" class="modal-content partner-form-content hidden" style="box-shadow: none; padding-top: 20px;">
                    <div class="partner-header">
                        <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                    </div>
                    <form id="partner-edit-form" onsubmit="event.preventDefault();">
                        <div class="form-group"><label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label><input type="text" id="p-contact" required></div>
                        <div class="form-group"><label>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è / –ò–ü</label><input type="text" id="p-name" required></div>
                        <div class="form-group"><label>–ò–ù–ù</label><input type="tel" id="p-inn" placeholder="–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù"></div>
                        <div class="form-group"><label>Email</label><input type="email" id="p-email" placeholder="email@example.com"></div>
                        <div style="display:flex; gap:10px; margin-top: 20px;">
                            <button class="btn btn-outline full-width" data-action="cancel-partner-edit">–û—Ç–º–µ–Ω–∞</button>
                            <button type="submit" class="btn btn-primary full-width" data-action="partner-update">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </div>
                    </form>
                </div>

                <!-- –î–∞—à–±–æ—Ä–¥ -->
                <div id="partner-dashboard"></div>
            </section>

        </main>

        <!-- MODALS -->
        <div id="project-detail-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal" data-action="close-modal">&times;</span>
                <div id="modal-body"></div>
            </div>
        </div>

        <div id="status-edit-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal" data-action="close-modal">&times;</span>
                <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                <div class="form-group">
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç: <span id="edit-percent-val">0</span>%</label>
                    <input type="range" id="edit-percent" min="0" max="100" step="5" class="calc-input">
                </div>
                <div class="form-group">
                    <label>–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞</label>
                    <input type="text" id="edit-status-text">
                </div>
                <div class="color-picker-row"></div>
                <button class="btn btn-primary full-width" data-action="save-status">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>

        <!-- NAVIGATION (ID –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è) -->
        <nav id="bottom-nav" class="bottom-nav">
            <div class="nav-item active" data-target="view-profile"><i class="fa-solid fa-user"></i><span>–≠–∫–æ–ª–æ–≥</span></div>
            <div class="nav-item" data-target="view-projects"><i class="fa-solid fa-briefcase"></i><span>–ü—Ä–æ–µ–∫—Ç—ã</span></div>
            <div class="nav-item" data-target="view-services"><i class="fa-solid fa-calculator"></i><span>–†–∞—Å—á–µ—Ç</span></div>
            <div class="nav-item" data-target="view-partner"><i class="fa-solid fa-building"></i><span>–ö–∞–±–∏–Ω–µ—Ç</span></div>
            <div class="nav-item admin-only hidden" data-target="view-partners"><i class="fa-solid fa-gem"></i><span>CRM</span></div>
        </nav>
    </div>

    <script src="js/data.js" defer></script>
    <script src="js/views.js" defer></script>
    <script src="js/logic.js" defer></script>
</body>
</html>