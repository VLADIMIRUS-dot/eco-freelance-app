<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EcoFreelance App</title>

    <!-- 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –°–¢–ò–õ–¨ (–í–°–¢–ê–í–õ–ï–ù –ü–†–Ø–ú–û –í HTML) -->
    <!-- –≠—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏ —É–±–∏—Ä–∞–µ—Ç –±–µ–ª—É—é –≤—Å–ø—ã—à–∫—É -->
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #212121; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden; /* –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –ø–æ–∫–∞ –≥—Ä—É–∑–∏—Ç—Å—è */
        }

        /* –ú–∞—Å–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
        #preloader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #212121; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
            z-index: 99999; /* –ü–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.3s ease-out;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ */
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid #3498db; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞ –≥—Ä—É–∑–∏—Ç—Å—è */
        #app-wrapper { opacity: 0; transition: opacity 0.5s; }
    </style>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –ø–æ–∫—Ä–∞—Å–∫–∏ —Ñ–æ–Ω–∞ –≤ —Ü–≤–µ—Ç —Ç–µ–º—ã –¢–µ–ª–µ–≥—Ä–∞–º–∞ -->
    <script>
        try {
            var tg = window.Telegram.WebApp;
            if (tg) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–º–∞ –¢–µ–ª–µ–≥—Ä–∞–º–∞, –∫—Ä–∞—Å–∏–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –≤ —ç—Ç–æ—Ç —Ü–≤–µ—Ç
                var bg = tg.themeParams.bg_color || '#212121';
                document.documentElement.style.backgroundColor = bg;
                document.body.style.backgroundColor = bg;
            }
        } catch(e) {}
    </script>

    <!-- –í–Ω–µ—à–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- –í–∞—à–∏ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/desktop.css">
</head>
<body>

    <!-- === –ü–†–ï–õ–û–ê–î–ï–† (–í–∏–¥–µ–Ω —Å—Ä–∞–∑—É) === -->
    <div id="preloader">
        <div class="spinner"></div>
        <div style="font-size: 12px; opacity: 0.6;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- === –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï === -->
    <div id="app-wrapper">
        <main id="main-content">

            <!-- –ü–†–û–§–ò–õ–¨ -->
            <section id="view-profile" class="view active"></section>

            <!-- –ü–†–û–ï–ö–¢–´ -->
            <section id="view-projects" class="view">
                <div class="section-header">
                    <h2>–ü—Ä–æ–µ–∫—Ç—ã</h2>
                    <div class="filters admin-only hidden">
                        <span class="filter-chip active">–í—Å–µ</span>
                        <span class="filter-chip">–î–æ–ª–∂–Ω–∏–∫–∏</span>
                        <span class="filter-chip">–í —Ä–∞–±–æ—Ç–µ</span>
                    </div>
                </div>
                <div id="projects-list" class="projects-container">
                    <div class="empty-state">
                        <i class="fa-solid fa-folder-open"></i><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
            </section>

            <!-- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† -->
            <section id="view-services" class="view">
                <div class="calc-mode-switch">
                    <button class="mode-btn active" onclick="switchCalcMode('simple', this)">–ë—ã—Å—Ç—Ä—ã–π</button>
                    <button class="mode-btn" onclick="switchCalcMode('advanced', this)">–°–º–µ—Ç–∞ (–ö–ü)</button>
                </div>
                <!-- Simple Mode -->
                <div id="calc-simple-mode">
                    <div class="calculator-card">
                        <div class="form-group">
                            <label>–ß—Ç–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º?</label>
                            <select id="calc-service-type"></select>
                        </div>
                        <div id="dynamic-calc-inputs"></div>
                        <div class="form-group">
                            <label>–î–æ–∫—É–º–µ–Ω—Ç—ã</label>
                            <div class="file-upload-area" id="file-drop-zone">
                                <input type="file" id="calc-file-input" multiple hidden>
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <span id="file-upload-text">–§–∞–π–ª—ã</span>
                            </div>
                            <div id="file-list-display" class="file-list"></div>
                        </div>
                        <div class="calc-result">
                            <div class="price-box"><span>–û—Ä–∏–µ–Ω—Ç–∏—Ä:</span><h3 id="calc-total-price">0 ‚ÇΩ</h3></div>
                            <div class="time-box"><span>–°—Ä–æ–∫:</span><strong id="calc-total-time">0 –¥–Ω–µ–π</strong></div>
                        </div>
                        <button class="btn btn-primary full-width" id="btn-order-calc">–û–±—Å—É–¥–∏—Ç—å —Ä–∞—Å—á–µ—Ç</button>
                    </div>
                    <div class="services-list"><h3>–°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥</h3><div id="services-container"></div></div>
                </div>
                <!-- Advanced Mode -->
                <div id="calc-advanced-mode" class="hidden">
                    <div id="estimate-container"></div>
                    <button class="btn btn-outline full-width dashed-btn" onclick="addNewObjectToEstimate()"><i class="fa-solid fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</button>
                    <div class="estimate-footer">
                        <div class="total-row"><span>–ò—Ç–æ–≥–æ:</span><strong id="estimate-total-sum">0 ‚ÇΩ</strong></div>
                        <button class="btn btn-primary full-width" onclick="sendEstimateToTelegram()">üìÑ –ü–æ–ª—É—á–∏—Ç—å –ö–ü</button>
                    </div>
                </div>
            </section>

            <!-- –ü–ê–†–¢–ù–ï–†–´ (CRM) -->
            <section id="view-partners" class="view admin-only hidden">
                <div class="section-header"><h2>–ü–∞—Ä—Ç–Ω–µ—Ä—ã (CRM)</h2></div>
                <div class="finance-dashboard">
                    <div class="fin-card red"><span>–î–µ–±–∏—Ç–æ—Ä–∫–∞</span><strong id="fin-debt">0 ‚ÇΩ</strong></div>
                    <div class="fin-card green"><span>–û–∂–∏–¥–∞—é</span><strong id="fin-wait">0 ‚ÇΩ</strong></div>
                </div>
                <div id="partners-list" class="partners-list"></div>
            </section>

            <!-- –ü–†–û–§–ò–õ–¨ –ü–ê–†–¢–ù–ï–†–ê -->
            <section id="view-partner" class="view">
                <div id="partner-auth" class="modal-content partner-form-content hidden" style="box-shadow: none; padding-top: 40px;">
                    <div class="partner-header"><i class="fa-solid fa-handshake"></i><h2>–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ</h2><p>–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.</p></div>
                    <form id="partner-form" onsubmit="event.preventDefault(); savePartnerProfile();">
                        <div class="form-group"><label>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label><input type="text" id="p-name" required></div>
                        <div class="form-group"><label>–ò–ù–ù</label><input type="tel" id="p-inn"></div>
                        <div class="form-group"><label>–ò–º—è</label><input type="text" id="p-contact"></div>
                        <div class="form-group"><label>Email</label><input type="email" id="p-email"></div>
                        <button type="submit" class="btn btn-primary full-width">–í–æ–π—Ç–∏</button>
                    </form>
                </div>
                <div id="partner-dashboard" class="hidden">
                    <div class="lk-header">
                        <div class="lk-avatar"><i class="fa-solid fa-building"></i></div>
                        <div class="lk-info"><h2 id="lk-company-name">...</h2><p id="lk-inn">...</p></div>
                        <button class="btn-icon-only" onclick="togglePartnerEditMode(true)"><i class="fa-solid fa-pen"></i></button>
                    </div>
                    <div class="loyalty-card">
                        <div class="loyalty-row"><span>–°—Ç–∞—Ç—É—Å:</span><strong id="lk-status">...</strong></div>
                        <div class="loyalty-desc">–í–∞—à–∞ —Å–∫–∏–¥–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.</div>
                    </div>
                    <div class="menu-list" style="margin-top: 0;">
                        <div class="menu-item" onclick="window.open('https://t.me/EcoSubcontract')">
                            <div class="menu-icon-box" style="background: rgba(36, 129, 204, 0.1); color: #2481cc;"><i class="fa-solid fa-headset"></i></div>
                            <div class="menu-text"><span>–ú–µ–Ω–µ–¥–∂–µ—Ä</span><small>–°–≤—è–∑—å</small></div>
                        </div>
                    </div>
                    <button class="btn btn-outline full-width" onclick="logoutPartner()" style="color: var(--status-red); margin-top: 20px;">–í—ã–π—Ç–∏</button>
                </div>
            </section>

        </main>

        <!-- –ú–û–î–ê–õ–ö–ò -->
        <div id="project-detail-modal" class="modal hidden">
            <div class="modal-content"><span class="close-modal">&times;</span><div id="modal-body"></div></div>
        </div>

        <div id="status-edit-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal" onclick="closeStatusModal()">&times;</span>
                <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                <div class="form-group"><label>–ü—Ä–æ—Ü–µ–Ω—Ç: <span id="edit-percent-val">0</span>%</label><input type="range" id="edit-percent" min="0" max="100" step="5"></div>
                <div class="form-group"><label>–¢–µ–∫—Å—Ç</label><input type="text" id="edit-status-text"></div>
                <div class="form-group">
                    <div class="color-picker-row">
                        <div class="color-circle" style="background:#2ecc71" onclick="selectStatusColor('#2ecc71')"></div>
                        <div class="color-circle" style="background:#f1c40f" onclick="selectStatusColor('#f1c40f')"></div>
                        <div class="color-circle" style="background:#e74c3c" onclick="selectStatusColor('#e74c3c')"></div>
                        <div class="color-circle" style="background:#3498db" onclick="selectStatusColor('#3498db')"></div>
                    </div>
                    <input type="hidden" id="edit-status-color">
                </div>
                <button class="btn btn-primary full-width" onclick="saveNewStatus()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" data-target="view-profile"><i class="fa-solid fa-user"></i><span>–≠–∫–æ–ª–æ–≥</span></div>
            <div class="nav-item" data-target="view-projects"><i class="fa-solid fa-briefcase"></i><span>–ü—Ä–æ–µ–∫—Ç—ã</span></div>
            <div class="nav-item" data-target="view-services"><i class="fa-solid fa-calculator"></i><span>–†–∞—Å—á–µ—Ç</span></div>
            <div class="nav-item" data-target="view-partner"><i class="fa-solid fa-building"></i><span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
            <div class="nav-item admin-only hidden" id="nav-partners" data-target="view-partners"><i class="fa-solid fa-gem"></i><span>CRM</span></div>
        </nav>
    </div>

    <!-- –°–ö–†–ò–ü–¢–´ (–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ) -->
    <script src="js/data.js" defer></script>
    <script src="js/views.js" defer></script>
    <script src="js/logic.js" defer></script>

    <!-- –°–ö–†–ò–ü–¢ –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –ü–†–ï–õ–û–ê–î–ï–†–ê -->
    <script>
        // –≠—Ç–æ—Ç –∫–æ–¥ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–≥–¥–∞ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –≤—Å–µ defer —Å–∫—Ä–∏–ø—Ç—ã
        window.onload = function() {
            setTimeout(function() {
                var preloader = document.getElementById('preloader');
                var app = document.getElementById('app-wrapper');
                
                // –ö—Ä–∞—Å–∏–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –≤ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ–º
                // –ß—Ç–æ–±—ã –ø–µ—Ä–µ—Ö–æ–¥ –±—ã–ª –±–µ—Å—à–æ–≤–Ω—ã–º
                if(window.Telegram && window.Telegram.WebApp) {
                    preloader.style.backgroundColor = window.Telegram.WebApp.themeParams.bg_color;
                }

                preloader.style.opacity = '0';
                app.style.opacity = '1';
                document.body.style.overflow = 'auto'; // –í–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª

                setTimeout(function() {
                    preloader.style.display = 'none';
                }, 300); // –ñ–¥–µ–º –ø–æ–∫–∞ –ø—Ä–æ–π–¥–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—è opacity
            }, 500); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ –ª–æ–∞–¥–µ—Ä–∞ (—á—Ç–æ–±—ã –Ω–µ –º–æ—Ä–≥–∞–ª —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ)
        };
    </script>
</body>
</html>
